<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HCC Pathology Report Generator</title>
    <style>
        :root { --primary-color: #00796b; --primary-hover: #004d40; --text-dark: #263238; --text-medium: #455a64; --bg-light: #eceff1; --bg-medium: #cfd8dc; --border-color: #b0bec5; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: var(--bg-light); line-height: 1.6; padding: 1rem; }
        .container { max-width: 1400px; margin: auto; background: white; border-radius: 0.75rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow: hidden; }
        .main-grid { display: grid; grid-template-columns: 1fr; gap: 2rem; padding: 1.5rem; }
        @media (min-width: 1024px) { .main-grid { grid-template-columns: 6fr 7fr; } }
        header { padding: 1.5rem; text-align: center; background-color: var(--primary-color); color: white; }
        h1 { font-size: 1.875rem; font-weight: 700; }
        h2 { font-size: 1.25rem; font-weight: 600; color: var(--text-dark); margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--primary-color); }
        fieldset { border: 1px solid var(--border-color); border-radius: 0.5rem; padding: 1rem; margin-bottom: 1.5rem; }
        legend { font-weight: 600; font-size: 1.1rem; color: var(--primary-color); padding: 0 0.5rem; }
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; font-size: 0.9rem; font-weight: 500; color: var(--text-medium); margin-bottom: 0.5rem; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 0.625rem 0.75rem; border: 1px solid var(--border-color); border-radius: 0.375rem; background-color: white; transition: all 0.2s; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(0, 121, 107, 0.2); }
        .btn { padding: 0.625rem 1.25rem; border-radius: 0.375rem; font-weight: 600; border: none; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: var(--primary-hover); }
        .output-section { background-color: var(--bg-light); padding: 1.5rem; border-radius: 0.5rem; display: flex; flex-direction: column; }
        #reportOutput { flex-grow: 1; background-color: #ffffff; border: 1px solid var(--border-color); border-radius: 0.375rem; padding: 1rem; font-family: "Courier New", Courier, monospace; font-size: 0.9rem; white-space: pre-wrap; overflow-y: auto; min-height: 600px; }
        .hidden { display: none !important; }
        .conditional-group { padding-left: 1rem; margin-top: 0.75rem; border-left: 3px solid var(--bg-medium); }
        .staging-output { background-color: var(--primary-color); color: white; padding: 0.75rem; border-radius: 0.375rem; text-align: center; font-weight: 600; font-size: 1.2rem; margin-top: 1rem; }
        .inline-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; }
        .specimen-block { border: 1px dashed var(--border-color); padding: 1rem; margin-top: 1rem; border-radius: 0.5rem; }
    </style>
</head>
<body>
    <div class="container">
        <header><h1>Hepatocellular Carcinoma (HCC) Report Generator</h1></header>
        <div class="main-grid">
            <form id="hcc-form">
                <fieldset>
                    <legend>Gross Description</legend>
                    <div class="inline-group">
                        <div class="form-group"><label for="specimen_count" class="form-label">No. of Containers</label><input type="number" id="specimen_count" class="form-input" min="1" value="1"></div>
                        <div class="form-group"><label for="liver_segment" class="form-label">Liver Segment</label><input type="text" id="liver_segment" class="form-input" placeholder="e.g., V"></div>
                    </div>
                    <div class="specimen-block">
                        <h4>Specimen #1 (Main Liver)</h4>
                        <div class="inline-group">
                            <div class="form-group"><label class="form-label">Size (cm)</label><input type="text" id="main_specimen_size" class="form-input" placeholder="e.g., 10x8x6"></div>
                            <div class="form-group"><label class="form-label">Weight (gm)</label><input type="text" id="main_specimen_weight" class="form-input" placeholder="e.g., 250"></div>
                        </div>
                    </div>
                    <div id="additional_specimens_container"></div>

                    <div class="form-group">
                        <label for="tumor_focality" class="form-label">B. Tumor Focality</label>
                        <select id="tumor_focality" class="form-select">
                            <option value="solitary">solitary without satellitosis</option>
                            <option value="solitary_satellitosis">solitary with satellitosis</option>
                            <option value="multiple">multiple</option>
                        </select>
                        <div id="focality_details" class="conditional-group hidden"><label class="form-label">Number:</label><input type="number" id="focality_number" class="form-input"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">C. Tumor Size (cm)</label>
                        <div class="inline-group">
                            <input type="text" id="tumor_size_l" class="form-input" placeholder="Length">
                            <input type="text" id="tumor_size_w" class="form-input" placeholder="Width">
                            <input type="text" id="tumor_size_d" class="form-input" placeholder="Depth">
                        </div>
                    </div>
                     <div class="form-group">
                        <label for="macro_vi" class="form-label">E. Macroscopic Venous Invasion</label>
                        <select id="macro_vi" class="form-select">
                            <option value="not_identified">Not identified</option>
                            <option value="present_not_major">Present (not in major branch)</option>
                            <option value="present_major">Present in major branch of hepatic or portal vein</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="nontumorous_liver" class="form-label">F. Non-tumorous Liver</label>
                        <select id="nontumorous_liver" class="form-select">
                            <option value="not cirrhotic">not cirrhotic</option>
                            <option value="cirrhotic">cirrhotic</option>
                        </select>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Microscopic Description</legend>
                    <div class="form-group">
                        <label for="hist_type" class="form-label">A. Histological Type</label>
                        <select id="hist_type" class="form-select">
                            <option>Hepatocellular carcinoma</option>
                            <option>Hepatocellular carcinoma, fibrolamellar variant</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="hist_grade" class="form-label">B. Histological Grade (Edmondson-Steiner)</label>
                        <select id="hist_grade" class="form-select">
                            <option>I</option>
                            <option selected>II</option>
                            <option>III</option>
                            <option>IV</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label class="form-label">E. Tumor Extension (select all that apply)</label>
                        <div>
                            <input type="checkbox" id="ext_major_portal" value="major_portal"><label for="ext_major_portal"> Involves a major branch of the portal vein</label><br>
                            <input type="checkbox" id="ext_hepatic_vein" value="hepatic_vein"><label for="ext_hepatic_vein"> Involves hepatic vein(s)</label><br>
                            <input type="checkbox" id="ext_peritoneum" value="peritoneum"><label for="ext_peritoneum"> Involves (perforates) visceral peritoneum</label><br>
                            <input type="checkbox" id="ext_gallbladder" value="gallbladder"><label for="ext_gallbladder"> Directly invades gallbladder</label><br>
                             <input type="checkbox" id="ext_other" value="other"><label for="ext_other"> Directly invades other adjacent organs</label><br>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="micro_vi" class="form-label">F. Lymph-vascular Invasion</label>
                        <select id="micro_vi" class="form-select">
                            <option value="not_identified">Not identified</option>
                            <option value="present_not_major">Present (not in major branch)</option>
                            <option value="present_major">Present in major branch of hepatic or portal vein</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="margin_status" class="form-label">G. Margin Status</label>
                        <select id="margin_status" class="form-select">
                             <option value="Free of carcinoma">Free of carcinoma</option>
                             <option value="Involved by carcinoma">Involved by carcinoma</option>
                        </select>
                         <div id="margin_details" class="conditional-group"><label class="form-label">Closest Margin (cm):</label><input type="number" step="0.1" id="margin_distance" class="form-input"></div>
                    </div>
                    <div class="form-group">
                        <label for="ishak_fibrosis" class="form-label">H. Ishak Modified Staging of Fibrosis</label>
                        <select id="ishak_fibrosis" class="form-select">
                            <option value="0/6">0/6 - No fibrosis</option>
                            <option value="1/6">1/6 - Fibrous expansion of some portal areas</option>
                            <option value="2/6">2/6 - Fibrous expansion of most portal areas</option>
                            <option value="3/6">3/6 - Occasional portal to portal bridging</option>
                            <option value="4/6">4/6 - Marked bridging</option>
                            <option value="5/6">5/6 - Marked bridging with occasional nodules</option>
                            <option value="6/6">6/6 - Cirrhosis</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">I. Gallbladder Finding</label>
                        <select id="gallbladder_finding" class="form-select">
                            <option>No pathologic change</option>
                            <option>Chronic cholecystitis</option>
                            <option>Chronic cholecystitis and cholelithiasis</option>
                             <option>Involved by carcinoma</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="ln_status" class="form-label">K. Regional Lymph Node Status</label>
                        <select id="ln_status" class="form-select">
                            <option value="not_applicable">Not applicable</option>
                            <option value="negative">Negative for malignancy</option>
                            <option value="positive">Metastatic carcinoma</option>
                        </select>
                        <div id="ln_details" class="conditional-group hidden">
                            <div class="inline-group">
                                <div><label class="form-label">Positive:</label><input type="number" id="ln_positive" class="form-input"></div>
                                <div><label class="form-label">Total:</label><input type="number" id="ln_total" class="form-input"></div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </form>
            
            <div class="output-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2>Generated Report</h2>
                    <button id="copyBtn" class="btn btn-primary">Copy Report</button>
                </div>
                <div class="form-group">
                    <label class="form-label">J. Tumor Staging (AJCC 8th Edition)</label>
                    <div id="staging_output" class="staging-output">pTX pNX</div>
                </div>
                <pre id="reportOutput"></pre>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('hcc-form');
    
    const calculateTNM = () => {
        // --- TNM Inputs ---
        const focality = document.getElementById('tumor_focality').value;
        const numTumors = (focality === 'solitary' || focality === 'solitary_satellitosis') ? 1 : (parseInt(document.getElementById('focality_number').value) || 2);
        
        const sizeL = parseFloat(document.getElementById('tumor_size_l').value) || 0;
        const sizeW = parseFloat(document.getElementById('tumor_size_w').value) || 0;
        const sizeD = parseFloat(document.getElementById('tumor_size_d').value) || 0;
        const largestSize = Math.max(sizeL, sizeW, sizeD);

        const macroVI = document.getElementById('macro_vi').value;
        const microVI = document.getElementById('micro_vi').value;
        const anyVascularInvasion = macroVI !== 'not_identified' || microVI !== 'not_identified';
        const majorVascularInvasion = macroVI === 'present_major' || microVI === 'present_major' || document.getElementById('ext_major_portal').checked || document.getElementById('ext_hepatic_vein').checked;

        const directInvasionOther = document.getElementById('ext_other').checked;
        const peritoneumPerforation = document.getElementById('ext_peritoneum').checked;

        const lnStatus = document.getElementById('ln_status').value;
        const lnPositive = parseInt(document.getElementById('ln_positive').value) || 0;

        // --- T-Stage Logic (AJCC 8th) ---
        let pT = 'pTX';
        if (majorVascularInvasion || directInvasionOther || peritoneumPerforation) {
            pT = 'pT4';
        } else if (numTumors > 1 && largestSize > 5) {
            pT = 'pT3';
        } else if ((numTumors === 1 && largestSize > 2 && anyVascularInvasion) || (numTumors > 1 && largestSize <= 5)) {
            pT = 'pT2';
        } else if (numTumors === 1 && largestSize > 2 && !anyVascularInvasion) {
            pT = 'pT1b';
        } else if (numTumors === 1 && largestSize <= 2) {
            pT = 'pT1a';
        }
        
        // --- N-Stage Logic ---
        let pN = 'pNX';
        if (lnStatus === 'positive' && lnPositive > 0) {
            pN = 'pN1';
        } else if (lnStatus === 'negative') {
            pN = 'pN0';
        } else if (lnStatus === 'not_applicable') {
             pN = 'pNX'; // Or pN0 if no nodes expected
        }

        document.getElementById('staging_output').textContent = `${pT} ${pN}`;
        return { pT, pN };
    };

    const generateReport = () => {
        const { pT, pN } = calculateTNM();
        const getValue = id => document.getElementById(id).value || '___';
        const getChecked = id => document.getElementById(id).checked;

        // --- DIAGNOSIS ---
        let diagnosis = "DIAGNOSIS:\n";
        diagnosis += `1. Hepatocellular carcinoma (${pT.replace('p','')}), liver, segment ${getValue('liver_segment')}, segmentectomy\n`;
        diagnosis += `2. ${getValue('gallbladder_finding')}, gallbladder, cholecystectomy\n\n`;

        // --- GROSS DESCRIPTION ---
        let gross = "GROSS DESCRIPTION:\n";
        const specimenCount = parseInt(getValue('specimen_count')) || 1;
        gross += `${specimenCount} specimen${specimenCount > 1 ? 's are' : ' is'} submitted in ${specimenCount} labeled container${specimenCount > 1 ? 's' : ''}.\n`;
        gross += `A. Specimen size: ${getValue('main_specimen_size')} cm and ${getValue('main_specimen_weight')} gm\n`;
        if (specimenCount > 1) {
             for (let i = 2; i <= specimenCount; i++) {
                gross += `   - Additional Specimen #${i} (${getValue(`specimen_${i}_desc`)}) size: ${getValue(`specimen_${i}_size`)} cm\n`;
            }
        }
        let focalityText = getValue('tumor_focality').replace(/_/g, ' ');
        if (focalityText.includes('solitary with satellitosis') || focalityText.includes('multiple')) {
            focalityText += ` (number: ${getValue('focality_number')})`;
        }
        gross += `B. Tumor focality: ${focalityText}\n`;
        gross += `C. Tumor size: ${getValue('tumor_size_l')} x ${getValue('tumor_size_w')} x ${getValue('tumor_size_d')} cm\n`;
        gross += `E. Macroscopic venous Invasion: ${getValue('macro_vi').replace(/_/g, ' ')}\n`;
        gross += `F. Non-tumorous liver: ${getValue('nontumorous_liver')}\n\n`;
        
        // --- MICROSCOPIC DESCRIPTION ---
        let micro = "MICROSCOPIC DESCRIPTION:\n";
        micro += `A. Histological type: ${getValue('hist_type')}\n`;
        micro += `B. Histological grade (Edmondson and Steiner system): ${getValue('hist_grade')}\n`;
        let extensionText = [];
        if(getChecked('ext_major_portal')) extensionText.push('involves a major branch of the portal vein');
        if(getChecked('ext_hepatic_vein')) extensionText.push('involves hepatic vein(s)');
        if(getChecked('ext_peritoneum')) extensionText.push('involves (perforates) visceral peritoneum');
        if(getChecked('ext_gallbladder')) extensionText.push('directly invades gallbladder');
        if(getChecked('ext_other')) extensionText.push('directly invades other adjacent organs');
        micro += `E. Tumor Extension: ${extensionText.length > 0 ? extensionText.join(', ') : 'Tumor confined to liver'}\n`;
        micro += `F. Lymph-vascular invasion: ${getValue('micro_vi').replace(/_/g, ' ')}\n`;
        let marginText = getValue('margin_status');
        if (marginText === 'Free of carcinoma') marginText += ` (${getValue('margin_distance')} cm from the closest margin)`;
        micro += `G. Margin status: ${marginText}\n`;
        micro += `H. Additional findings in the non-tumorous liver:\n`;
        micro += `   1. Ishak modified staging of fibrosis: (${getValue('ishak_fibrosis')})\n`;
        micro += `I. Gallbladder: ${getValue('gallbladder_finding')}\n`;
        micro += `J. Tumor staging (AJCC 8th Edition): ${pT} ${pN}\n`;
        let lnText = getValue('ln_status').replace('_', ' ');
        if(lnText === 'negative' || lnText === 'positive'){
            lnText = `${lnText.charAt(0).toUpperCase() + lnText.slice(1)} for malignancy (${getValue('ln_positive')}/${getValue('ln_total')}, ${pN.replace('p','')})`
        }
        micro += `K. Regional lymph node status: ${lnText}\n`;
        
        document.getElementById('reportOutput').textContent = diagnosis + gross + micro;
    };
    
    // --- Event Listeners ---
    form.addEventListener('input', () => {
        calculateTNM();
        generateReport();
    });
    
    document.getElementById('specimen_count').addEventListener('input', (e) => {
        const container = document.getElementById('additional_specimens_container');
        container.innerHTML = '';
        const count = parseInt(e.target.value) || 1;
        if (count > 1) {
            for (let i = 2; i <= count; i++) {
                const block = document.createElement('div');
                block.className = 'specimen-block';
                block.innerHTML = `<h4>Specimen #${i}</h4>
                    <div class="form-group"><label class="form-label">Description:</label><input type="text" id="specimen_${i}_desc" class="form-input" placeholder="e.g., Gallbladder"></div>
                    <div class="form-group"><label class="form-label">Size (cm):</label><input type="text" id="specimen_${i}_size" class="form-input" placeholder="e.g., 5x3x2"></div>`;
                container.appendChild(block);
            }
        }
    });

    document.getElementById('tumor_focality').addEventListener('change', (e) => {
        document.getElementById('focality_details').classList.toggle('hidden', !e.target.value.includes('satellitosis') && e.target.value !== 'multiple');
    });

     document.getElementById('margin_status').addEventListener('change', (e) => {
        document.getElementById('margin_details').classList.toggle('hidden', e.target.value !== 'Free of carcinoma');
    });

    document.getElementById('ln_status').addEventListener('change', (e) => {
        document.getElementById('ln_details').classList.toggle('hidden', e.target.value === 'not_applicable');
    });
    
    document.getElementById('copyBtn').addEventListener('click', () => {
        navigator.clipboard.writeText(document.getElementById('reportOutput').textContent).then(() => {
            const btn = document.getElementById('copyBtn');
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = 'Copy Report', 2000);
        });
    });

    // Initial setup
    calculateTNM();
    generateReport();
    document.getElementById('focality_details').classList.add('hidden');
    document.getElementById('ln_details').classList.add('hidden');
});
</script>
</body>
</html>